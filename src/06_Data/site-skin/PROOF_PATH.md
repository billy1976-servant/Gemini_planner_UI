# Proof path: JSON → Layout → Regions → Molecules

The screen is rendered from JSON molecules, not TSX hardcoding. This document describes the pipeline so you can verify that a content-only edit in skin JSON changes the visible UI without any TSX or molecule/atom edit.

**Canonical path:** skin JSON → loadSiteSkin → applySkinBindings → composeScreen → shells → JsonRenderer.

## Pipeline

1. **Skin JSON** — Loaded via `loadSiteSkin(domain, pageId)` or passed as `skin` prop; slots resolved by `applySkinBindings(doc, data)`.
2. **Role-tagged nodes** — `siteSkinToRoleTaggedNodes(doc)` produces a flat list of content nodes with `role` (header, hero, content, products, footer, etc.).
3. **Composition** — `composeScreen({ roleTaggedNodes, layoutState, experienceProfile })` (pure, no stores) assigns nodes to regions and orders regions by experience (website / app / learning).
4. **Region sections** — `collectRegionSections(nodeTree)` yields a map of region key → section node.
5. **Rendering** — Each region is rendered by `renderRegion(…)` → `JsonRenderer` with `profileOverride` (experience profile). JsonRenderer looks up `node.type` in the Registry and renders the matching molecule or atom.
6. **Shell** — WebsiteShell / AppShell / LearningShell only position region slots (layout containers); they do not render fixed copy or structure for hero/header/cards.

## DOM proof

The root of the skin output is a wrapper with:

- `data-skin-source="json"` — Indicates the tree came from a skin document.
- `data-skin-domain` — Skin domain (e.g. `containercreations.com`).
- `data-skin-page-id` — Page id (e.g. `home`).

Inspect the DOM to confirm the visible content is under this element; changing a label or title in the skin JSON and refreshing will update the UI without code changes.

## Debug

- **`?debug=1`** — JsonRenderer shows debug outlines per node.
- **`?debugRegions=1`** — SiteSkin logs region structure and shows the region debug overlay.

## Experience reflow acceptance (Phase 2)

For one fixed skin (e.g. `home`), the same role-tagged nodes are recomposed by experience. Expected regions per experience:

| Experience | Region order (getRegionOrder) | Shell |
|------------|-------------------------------|-------|
| **website** | header, hero, content, products, footer | WebsiteShell |
| **app** | nav, header, primary, sidebar, actions, footer | AppShell |
| **learning** | header, content, actions, footer | LearningShell |

**Check:** Load demo with home skin, note one unique string (e.g. hero title). Switch Experience to App, then Learning: the same string appears in a different place/layout each time; no content disappears. With `?debugRegions=1`, console shows different region lists per experience; DOM order/structure matches.

## Content pipeline (Phase 3)

The canonical source for website/app skin content is either:

1. **Hand-authored `.skin.json`** — Under `src/content/sites/<domain>/compiled/skins/<pageId>.skin.json` with `nodes` (role-tagged) and optional `dataSlots`. The skins API serves these at `/api/sites/[domain]/skins/[pageId]`.

2. **Build step** — Use `compileSkinFromBlueprintScreen` from [compileSkinFromBlueprint.ts](src/lib/site-skin/compileSkinFromBlueprint.ts) to convert a blueprint-style screen (sections + children) into a SiteSkinDocument with `nodes[]` and inferred roles, then write `.skin.json`. Skin JSON is the contract; it can be generated by the existing adapter from any screen tree that matches the blueprint shape.

## Demo URLs (Phase 4)

Three canonical entry points (same skin, experience from URL or Navigator dropdown):

| # | URL | What to expect |
|---|-----|----------------|
| 1 | `/?screen=tsx:tsx-screens/site-skin/SiteSkinPreviewScreen&domain=containercreations.com&pageId=home` or `&experience=website` | Marketing layout: hero, header, content, products, footer; maxWidth; gradient from palette. |
| 2 | Same URL with `&experience=app` or switch Experience to App | Same content in app layout: nav, header, primary, sidebar, footer/actions. |
| 3 | Same URL with `&experience=learning` or switch Experience to Learning | Same content in linear/lesson layout: header, content, actions, footer. |

Experience and Palette dropdowns in the Navigator bar control layout-store and palette-store. Debug: `?debug=1` (node outlines), `?debugRegions=1` (region overlay).
